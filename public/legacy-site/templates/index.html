<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>960 Dojo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dropdown.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chessboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/selectors.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/others.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body>
    <header>
        <nav class="buttons">
            <div class="dropdown">
                <button class="login-button" id="loginBtn" title="Login">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="#333" viewBox="0 0 24 24"
                        aria-hidden="true">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    <span id="loginName" class="login-name"></span>
                </button>
                <div class="dropdown-content" id="dropdownContent">
                    <!-- JS fills this -->
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="selectors">
            <select id="Category" class="dropdown">
                <option value="Random">Random</option>
                <option value="Number Selection">Number Selection</option>
                <option value="Standard">Standard</option>
                <option value="Fixed Piece">Fixed Piece</option>
            </select>
            <div id="fixedPieceSelectors" style="display: none;">
                <select id="PieceSelector" class="dropdown">
                    <option value="Knight">Knight</option>
                    <option value="Bishop">Bishop</option>
                    <option value="Rook">Rook</option>
                    <option value="Queen">Queen</option>
                    <option value="King">King</option>
                </select>
                <select id="SquareFixPieceSelector1" class="dropdown">
                    <option value="a">a</option>
                    <option value="b">b</option>
                    <option value="c">c</option>
                    <option value="d">d</option>
                    <option value="e">e</option>
                    <option value="f">f</option>
                    <option value="g">g</option>
                    <option value="h">h</option>
                </select>
                <select id="SquareFixPieceSelector2" class="dropdown">
                    <option value="-">-</option>
                    <option value="a">a</option>
                    <option value="b">b</option>
                    <option value="c">c</option>
                    <option value="d">d</option>
                    <option value="e">e</option>
                    <option value="f">f</option>
                    <option value="g">g</option>
                    <option value="h">h</option>
                </select>
            </div>

            <div id="numberSelectContainer" class="number-select-container"></div>

            <select id="numberSelect" class="dropdown" disabled>
                {% for i in range(0, 960) %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </section>

        <section class="chessboard-container">
            <button class="lichess-analysis" id="lichessBtn" style="
            display: none;
            position: absolute;
            top: 0px;
            left: 50%;
            margin-top: 170px;
            margin-left: 210px;
            ">
                Lichess Analysis
            </button>

            <div class="loading-spinner" id="loading-circle" style="
            display: none;
            position: absolute;
            top: 0;
            left: 50%;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            border: 8px solid #8abfe2;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            z-index: 1000;
            pointer-events: none;
            margin-top: 170px;
            margin-left: -350px;
            "></div>

            <div class="chessboard" id="chessboard" style="position: relative;">
                {% for row in range(8) %}
                <div class="row">
                    {% for col in range(8) %}
                    <div class="square {% if (row + col) % 2 == 0 %}white{% else %}black{% endif %}"
                        data-row="{{ row }}" data-col="{{ col }}" data-square="{{ 'abcdefgh'[col] }}{{ 8 - row }}">
                        <!-- Pieces added by JavaScript -->
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
                <canvas id="arrow-layer"
                    style="position: absolute; top: 0; left: 0; pointer-events: none; z-index: 4;"></canvas>
            </div>


            <div class="controls-container">
                <div class="mode">
                    <button id="ratedBtn" class="inactive">Rated</button>
                    <button id="trainingBtn" class="active">Training</button>
                </div>
                <div class="button-separator"></div>
                <div class="color">
                    <button id="whiteBtn" class="active">White</button>
                    <button id="blackBtn" class="inactive">Black</button>
                    <button id="randomBtn" class="color-btn inactive">Random</button>
                </div>
                <div class="button-separator"></div>
                <div class="action-buttons">
                    <button id="startBtn" class="start-button">Start</button>
                </div>

                <!-- Move List View (initially hidden) -->
                <div id="moveListView" class="move-list-view" style="display: none;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button id="backBtn" class="back-button"></button>
                        <button id="browseallthewaybackBtn" class="browse-all-the-way-back"></button>
                        <button id="browsebackBtn" class="browseback"></button>
                        <button id="browseforwardBtn" class="browseforward"></button>
                        <button id="browseallthewayforwardBtn" class="browse-all-the-way-forward"></button>
                    </div>
                    <ul id="moveList" class="move-list"></ul>
                </div>

                <div class="move-list-container" id="moveListContainer" style="position: relative;">
                    <div style="display: flex; gap: 8px; align-items: center; position: relative;"
                        id="browseButtonContainer">
                        <button class="back-button" id="backButton"></button>
                        <button id="browseallthewayback" class="browseallthewayback"
                            style="position: absolute; right: -50px;"></button>
                        <button id="browseback" class="browseback" style="position: absolute; right: -95px;"></button>

                        <button id="browseforward" class="browseforward"
                            style="position: absolute; right: -140px;"></button>
                        <button id="browseallthewayforward" class="browseallthewayforward"
                            style="position: absolute; right: -185px;"></button>
                    </div>
                    <ul class="move-list" id="moveList">
                        <!-- Moves will go here -->
                    </ul>
                </div>
                <!-- Place the Play Again button directly after the move-list-container to keep it positioned relative to the move list -->
                <div style="position: relative;">
                    <button id="playAgainBtn" class="start-button"
                        style="display:none; position:absolute; top:120%; left:60%; transform:translate(-50%, 20px); z-index:1200; pointer-events:auto; width:200px;">Play
                        Again</button>
                </div>
            </div>

        </section>

        <section class="text-output" style="margin-left: -250px; display: flex; align-items: center;">
            <span class="rating-box">
                Rating: <span id="ratingDisplay">1500</span>
            </span>
            <span style="display: flex; flex-direction: column; margin-left: 8px;" id="ratingChangeButtons">
                <button id="ratingUp"
                    style="background: none; border: none; padding: 0; cursor: pointer; height: 28px;">
                    <svg width="28" height="20" viewBox="0 0 14 10" style="display: block;">
                        <polygon points="7,2 2,8 12,8" fill="#adf" />
                    </svg>
                </button>
                <button id="ratingDown"
                    style="background: none; border: none; padding: 0; cursor: pointer; height: 28px;">
                    <svg width="28" height="20" viewBox="0 0 14 10" style="display: block;">
                        <polygon points="2,2 12,2 7,8" fill="#adf" />
                    </svg>
                </button>
            </span>
        </section>

        <div id="loginMessage" style="color: red; display: none; margin-top: 10px;">
            Log in to play rated
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/stockfish.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/chess_constants.js') }}" nonce="{{ csp_nonce }}"></script>
    <script defer src="{{ url_for('static', filename='js/chess_logic.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/constants_and_globals.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/utility_functions.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/board_setup_and_drawing.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/game_mode_and_color_selection.js') }}"
        nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/login_and_user.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/game_flow.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/move_list_display.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/square_click_handling.js') }}" nonce="{{ csp_nonce }}"></script>
    <script src="{{ url_for('static', filename='js/event_listeners_and_init.js') }}" nonce="{{ csp_nonce }}"></script>
</body>

</html>